{% extends '::base.html.twig' %}

{% block title -%} Turnyras {{ tournament.name }} |{% endblock %}

{% block body -%}

    <div class="row">
        <div class="col-md-12">
            <div class="btn-group" role="group" aria-label="...">
                <a class="btn btn-primary" href="{{ path('tournaments') }}">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                </a>
                {% if is_granted('IS_AUTHENTICATED_FULLY') and (is_granted('ROLE_ADMIN') or app.user == tournament.organizer) %}
                    <a class="btn btn-warning" href="{{ path('tournament_edit', {id: tournament.id}) }}">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </a>
                    <a class="btn btn-danger" href="#delete_popup" id="delete-btn">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </a>
                {% endif %}
            </div>
            {% if is_granted('IS_AUTHENTICATED_FULLY') and (is_granted('ROLE_ADMIN') or app.user == tournament.organizer) %}
                <div id="delete_popup" style="display: none;">
                    <p>Ar tikrai norite ištrinti šį turnyrą?</p>

                    <div class="text-center">
                        {{ form_start(delete_form) }}
                        {{ form_row(delete_form.submit) }}
                        {{ form_end(delete_form) }}
                    </div>
                </div>
            {% endif %}
            <h1>
                {{ tournament.name }}
                <small>
                    <a href="{{ path('table_show', {'id': tournament.table.id}) }}">
                        <span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span>
                        "{{ tournament.table.name }}"
                        {{ tournament.table.address }}, {{ tournament.table.city }}
                    </a>
                </small>
            </h1>
            <p>
                <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
                {{ tournament.organizer.email }}
            </p>
        </div>
    </div>
    <div id="tournament-info" class="row"
         data-url="{{ url('tournament_show', {'id': tournament.id}) }}"
         data-dataurl="{{ url('table_status', {'id': tournament.table.id}) }}">
        <div class="col-md-12">
            <h5>
                {% if date(tournament.startTime) > date() and tournament.endTime == 0 %}
                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                    Turnyras prasidės už
                    {% set diff = date().diff(date(tournament.startTime)) %}
                    {% if diff.days > 1 %}
                        {{ diff.days }} dienų
                    {% elseif diff.h > 1 %}
                        {{ diff.h }} val.
                    {% else %}
                        {{ diff.i }} min.
                    {% endif %}
                {% elseif date(tournament.startTime) < date() and tournament.endTime == 0 %}
                    Šiuo metu vyksta turnyras
                {% else %}
                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                    {{ tournament.startTime|date('Y-m-d H:i') }} - {{ tournament.endTime|date('Y-m-d H:i') }}
                {% endif %}
            </h5>
            {% if (date(tournament.startTime) <= date() and tournament.endTime == 0)
            or (is_granted('ROLE_ADMIN') or app.user == tournament.organizer) %}
                {% if not game == NULL %}
                    <div id="match">
                        <h3 class="text-center">{{ game.getGoals(0) }} : {{ game.getGoals(1) }}</h3>
                        <table class="table table-striped text-center">
                            <tr>
                                <td>{{ game.competitor1.team.name }}</td>
                            </tr>
                            <tr>
                                <td>VS</td>
                            </tr>
                            <tr>
                                <td>{{ game.competitor2.team.name }}</td>
                            </tr>
                        </table>
                    </div>
                {% endif %}
                <div id="tournament"
                     data-url="{{ url('tournament_update_from_json', {'id': tournament.id}) }}"
                     data-data='{{ data }}'>
                </div>
            {% elseif not isCompetitor %}
                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                    <h3>Prisijunkite prie turnyro</h3>
                    <div class="list-group">
                        <a href="#new_team" id="create_popup" class="list-group-item">Nauja komanda</a>
                        {% for competitor in competitors %}
                            {% if competitor.team.player == null %}
                                <a href="#" class="play list-group-item"
                                   data-url="{{ url('tournament_add_player', {id: tournament.id }) }}"
                                   data-team="{{ competitor.team.id }}">
                                    {{ competitor.team.captain.name }} {{ competitor.team.captain.surname }} komanda
                                </a>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div id="popups" style="display: none;">
                        <div id="new_team">
                            <form>
                                <div class="form-group">
                                    <h4 style="margin: 0">Įveskite komandos pavadinimą</h4>
                                </div>
                                <div id="team_name" class="form-group">
                                    <label class="sr-only" for="team_name">Komandos pavadinimas</label>
                                    <span class="help-block hidden">We have a situation here...</span>
                                    <input type="email" class="form-control" placeholder="Pavadinimas">
                                </div>
                                <button id="create_team" class="btn btn-success btn-block"
                                        data-team="new"
                                        data-url="{{ url('tournament_add_player', {id: tournament.id }) }}">Sukurti
                                </button>
                            </form>
                        </div>
                    </div>
                {% else %}
                    <p>Jeigu norite dalyvauti turnyre prašome prisijungti.</p>
                {% endif %}
            {% elseif is_granted('IS_AUTHENTICATED_FULLY') %}
                <h3>Jūs jau dalyvaujate šiame turnyre.</h3>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {% if is_granted('ROLE_ADMIN') or app.user == tournament.organizer %}
        {{ include('LiuksGameBundle:Tournament:bracketAdmin.html.twig') }}
    {% else %}
        {{ include('LiuksGameBundle:Tournament:bracket.html.twig') }}
    {% endif %}
{% endblock %}
