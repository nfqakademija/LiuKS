{% extends '::base.html.twig' %}

{% block title -%} Turnyras {{ tournament.name }} |{% endblock %}

{% block body -%}

    <div class="row">
        <div class="col-md-12">
            <h1>
                {{ tournament.name }}<br>
                <small>
                    <span class="glyphicon glyphicon-king" aria-hidden="true"></span>
                    {{ tournament.organizer.email }}
                </small>
                <small>
                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                    {{ tournament.startTime|date('Y-m-d H:i') }}
                </small><br>
                <small>
                    <a href="{{ path('table_show', {'id': tournament.table.id}) }}">
                        <span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span>
                        {{ tournament.table.address }}
                    </a>
                </small>
            </h1>
        </div>
    </div>

    {% if tournament.organizer == app.user or is_granted('ROLE_ADMIN') %}
        <div class="row">
            <div class="col-md-12">
                <ul class="list-inline">
                    <li><a href="{{ path('tournaments') }}"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></a></li>
                    <li><a href="{{ path('tournament_edit', { 'id': tournament.id }) }}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
                    <li>{{ form(delete_form) }}</li>
                </ul>
            </div>
        </div>
    {% endif %}

    <div id="tournament-info" class="row">
        <div class="col-md-12">
            {% if date(tournament.startTime) < date() %}
                <h3>Šiuo metu vyksta turnyras</h3>
                <div id="tournament"></div>
            {% elseif not isCompetitor %}
                <h3>Prisijunkite prie turnyro</h3>
                <div class="list-group">
                    <a href="#" class="play list-group-item" data-team="new">Nauja komanda</a>
                    {% for competitor in competitors %}
                        {% if competitor.team.player == null %}
                            <a href="#" class="play list-group-item" data-team="{{ competitor.team.id }}">
                                {{ competitor.team.captain.name }} {{ competitor.team.captain.surname }} komanda
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
            {% elseif is_granted('IS_AUTHENTICATED_FULLY') %}
                <h3>Jūs jau dalyvaujate šiame turnyre.</h3>
            {% endif %}
        </div>
    </div>

{% endblock %}
{% block javascripts %}
    <script id="tournament-script">
        jQuery(document).ready(function($){
            var data = {{ data|json_encode|raw }};
            var $tournament = $('#tournament');
            if (typeof data != "undefined" && $tournament.length != 0)
            {
                $tournament.bracket({
                    init: data
                });
            }
            else
            {
                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                    $('.play').on('click', function(e){
                        e.preventDefault();
                        $.ajax({
                            method: 'POST',
                            url: '{{ url('tournament_add_player', {id: tournament.id }) }}',
                            data: {team: $(this).attr('data-team')},
                            success: function(msg){
                                if (msg)
                                {
                                    $('#tournament-info').find('> div').html('<h3>Sveikinu! Jūs užsiregistravote į turnyrą.</h3>');
                                }
                            }
                        });
                    });
                {% endif %}
            }
        });
    </script>
{% endblock %}
