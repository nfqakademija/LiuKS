{% extends '::base.html.twig' %}

{% block title -%} Turnyras {{ tournament.name }} |{% endblock %}

{% block body -%}

    <div class="row">
        <div class="col-md-12">
            <h1>
                {{ tournament.name }}<br>
                <small>
                    <span class="glyphicon glyphicon-king" aria-hidden="true"></span>
                    {{ tournament.organizer.email }}
                </small>
                <small>
                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                    {{ tournament.startTime|date('Y-m-d H:i') }}
                </small><br>
                <small>
                    <a href="{{ path('table_show', {'id': tournament.table.id}) }}">
                        <span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span>
                        {{ tournament.table.address }}
                    </a>
                </small>
            </h1>
        </div>
    </div>

    {% if tournament.organizer == app.user or is_granted('ROLE_ADMIN') %}
        <div class="row">
            <div class="col-md-12">
                <ul class="list-inline">
                    <li><a href="{{ path('tournaments') }}"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></a></li>
                    <li><a href="{{ path('tournament_edit', { 'id': tournament.id }) }}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
                    <li>{{ form(delete_form) }}</li>
                </ul>
            </div>
        </div>
    {% endif %}

    <div id="tournament-info" class="row">
        <div class="col-md-12">
            {% if date(tournament.startTime) < date() %}
                <h3>Šiuo metu vyksta turnyras</h3>
                <div id="tournament" data-url="{{ url('tournament_update_from_json', {'id': tournament.id}) }}"></div>
            {% elseif not isCompetitor and is_granted('IS_AUTHENTICATED_FULLY') %}
                <h3>Prisijunkite prie turnyro</h3>
                <div class="list-group">
                    <a href="#new_team" id="create_popup" class="list-group-item">Nauja komanda</a>
                    {% for competitor in competitors %}
                        {% if competitor.team.player == null %}
                            <a href="#" class="play list-group-item"
                               data-url="{{ url('tournament_add_player', {id: tournament.id }) }}"
                               data-team="{{ competitor.team.id }}">
                                {{ competitor.team.captain.name }} {{ competitor.team.captain.surname }} komanda
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
                <div id="popups" style="display: none;">
                    <div id="new_team">
                        <form>
                            <div class="form-group">
                                <h4 style="margin: 0">Įveskite komandos pavadinimą</h4>
                            </div>
                            <div id="team_name" class="form-group">
                                <label class="sr-only" for="team_name">Komandos pavadinimas</label>
                                <span class="help-block hidden">We have a situation here...</span>
                                <input type="email" class="form-control" placeholder="Pavadinimas">
                            </div>
                            <button id="create_team" class="btn btn-success btn-block"
                                    data-team="new"
                                    data-url="{{ url('tournament_add_player', {id: tournament.id }) }}">Sukurti
                            </button>
                        </form>
                    </div>
                </div>
            {% elseif is_granted('IS_AUTHENTICATED_FULLY') %}
                <h3>Jūs jau dalyvaujate šiame turnyre.</h3>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {% if is_granted('ROLE_ADMIN') %}
        {{ include('LiuksGameBundle:Tournament:bracketAdmin.html.twig', {'data': data}) }}
    {% else %}
        {{ include('LiuksGameBundle:Tournament:bracket.html.twig', {'data': data}) }}
    {% endif %}
{% endblock %}
